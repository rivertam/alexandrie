<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Alexandrie</title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="expanded "><a href="getting-started.html"><strong aria-hidden="true">2.</strong> Getting started</a></li><li class="expanded "><a href="concepts/mod.html"><strong aria-hidden="true">3.</strong> Concepts</a></li><li><ol class="section"><li class="expanded "><a href="concepts/crate-index.html"><strong aria-hidden="true">3.1.</strong> Crate index</a></li><li class="expanded "><a href="concepts/crate-storage.html"><strong aria-hidden="true">3.2.</strong> Crate storage</a></li></ol></li><li class="expanded "><a href="whats-available/mod.html"><strong aria-hidden="true">4.</strong> What's available ?</a></li><li><ol class="section"><li class="expanded "><a href="whats-available/index-management-strategies.html"><strong aria-hidden="true">4.1.</strong> Index management strategies</a></li><li class="expanded "><a href="whats-available/crate-stores.html"><strong aria-hidden="true">4.2.</strong> Crate stores</a></li><li class="expanded "><a href="whats-available/docker.html"><strong aria-hidden="true">4.3.</strong> Docker</a></li></ol></li><li class="expanded "><a href="database-layout.html"><strong aria-hidden="true">5.</strong> Database layout</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Alexandrie</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#welcome-to-alexandrie" id="welcome-to-alexandrie">Welcome to Alexandrie</a></h1>
<p><a href="https://github.com/Hirevo/alexandrie"><img src="https://img.shields.io/badge/GitHub-Hirevo%2Falexandrie-brightgreen" alt="github-badge" /></a>
<img src="https://img.shields.io/crates/l/alexandrie" alt="license-badge" /></p>
<p><strong>Alexandrie</strong> is a modular alternative crate registry for Rust crates.</p>
<p><img src="./frontend-capture.png" alt="frontend-capture" /></p>
<p>It implements the Rust's <a href="https://github.com/rust-lang/rfcs/blob/master/text/2141-alternative-registries.md"><strong>Alternative Crate Registries RFC</strong></a> in order to be usable with <a href="https://doc.rust-lang.org/cargo"><strong>Cargo</strong></a>.<br />
It seeks to be <strong>modular</strong>, <strong>extensible</strong> and <strong>configurable</strong> to be usable in many different environments, from a openly-accessible crate store to a private registry in a company's toolchain.</p>
<p>It includes both a <strong>programmatic API</strong> and an optional <strong>server-rendered frontend</strong>.</p>
<h1><a class="header" href="#getting-started" id="getting-started">Getting started</a></h1>
<h2><a class="header" href="#how-to-build" id="how-to-build">How to build</a></h2>
<p>Alexandrie offers multiple options to be used as its database, so before building Alexandrie, you'll need to pick which supported database vendor you wish to use.<br />
The currently supported vendors are:</p>
<ul>
<li><strong><code>sqlite</code></strong>: for SQLite</li>
<li><strong><code>mysql</code></strong>: for MySQL (including MariaDB)</li>
<li><strong><code>postgres</code></strong>: for PostgreSQL</li>
</ul>
<p>To build, you can then run:</p>
<pre><code class="language-bash">cargo build [--release] \
    --no-default-features \
    --features [frontend] [sqlite|mysql|postgres]
</code></pre>
<p>Before running Alexandrie, you'll need to configure your instance in the <code>alexandrie.toml</code> file.</p>
<p>The database is configured through the <code>[database]</code> table:</p>
<pre><code class="language-toml">[database]
# Replace the '&lt;...&gt;' placeholders by the real values.

# For MySQL
url = &quot;mysql://&lt;user&gt;:&lt;password&gt;@&lt;hostname&gt;:&lt;port&gt;/&lt;database&gt;&quot;

# For PostgreSQL
url = &quot;postgresql://&lt;user&gt;:&lt;password&gt;@&lt;hostname&gt;:&lt;port&gt;/&lt;database&gt;&quot;

# For SQLite
url = &quot;&lt;path-to-sqlite-file&gt;&quot;
# or:
url = &quot;:memory:&quot; # ephemeral in-memory database, doesn't persists between restarts
</code></pre>
<p>Then, you can configure the crates' tarballs storage strategy and the crate index management strategy that you want to use.</p>
<p>Here is an example of how to do it:</p>
<pre><code class="language-toml">[index]
type = &quot;command-line&quot;
path = &quot;crate-index&quot;

[storage]
type = &quot;disk&quot;
path = &quot;crate-storage&quot;
</code></pre>
<p>You can find more information about crate index management and crate stores in the <strong>'What's available'</strong> section of this book.</p>
<p>You can also configure things like the address and port of the server:</p>
<pre><code class="language-toml">[general]
addr = &quot;127.0.0.1&quot;  # Endpoint on which to serve the service.
port = 3000         # Port on which to serve the service.
</code></pre>
<p>To run the registry with the configuration above, be sure to clone your crate index at the location designated by the <code>path</code> key in <code>[index]</code>.<br />
In this case, it is <code>./crate-index</code>.<br />
To clone an existing crate index, you can run:</p>
<pre><code class="language-bash"># Replace the '&lt;...&gt;' placeholders by the real ones.
git clone &lt;url-of-the-crate-index&gt; &lt;path-from-config&gt;
</code></pre>
<p>If you want to create one, you can refer to the <a href="https://github.com/rust-lang/rfcs/blob/master/text/2141-alternative-registries.md#registry-index-format-specification"><strong>Cargo's Alternative Registries RFC</strong></a> to learn about the layout of such an index.<br />
You can also visit the <a href="https://github.com/rust-lang/crates.io-index"><strong>crates.io index</strong></a> or the <a href="https://github.com/Hirevo/alexandrie-index"><strong>crates.polomack.eu index</strong></a> as deployed examples.</p>
<h2><a class="header" href="#how-to-run" id="how-to-run">How to run</a></h2>
<p>Once everything is configured, you can run with: <code>cargo run [--release]</code>.</p>
<p>Then, if you want to use this index with Cargo, you can follow these steps:</p>
<ul>
<li>Edit or create the <code>~/.cargo/config</code> file, and add the following code:
<pre><code class="language-toml"># Replace the '&lt;...&gt;' placeholders by the real ones.
[registries.&lt;name-of-your-registry&gt;]
index = &quot;&lt;url-of-the-crate-index&gt;&quot;
</code></pre>
</li>
<li>Then, run <code>cargo login --registry &lt;name-of-your-registry&gt;</code> and enter your author token.<br />
To generate a token, you need to register as an author first.
You can do this using the frontend by:
<ul>
<li>Registering at <code>/account/register</code>.</li>
<li>Generating a token at <code>/account/manage</code>.</li>
</ul>
</li>
<li>You can now use the registry using <code>cargo [search|publish] --registry &lt;name-of-your-registry&gt;</code></li>
</ul>
<h1><a class="header" href="#concepts" id="concepts">Concepts</a></h1>
<p>This sections covers the different concepts that Alexandrie defines and uses.</p>
<p>The goal of these concepts is to formally define how the different parts of Alexandrie interacts.<br />
Alexandrie can operate with both its crate index and storage on different remote machines and this brings in the need for a well-defined definition of what each of these parts are responsible for.</p>
<p>Alexandrie is built around two principal concepts:</p>
<ul>
<li><strong>Crate index</strong>: manages metadata about published crates.</li>
<li><strong>Crate store</strong>: stores actual contents of the published crates (code, assets, etc...).</li>
</ul>
<p>A <strong>crate index</strong> is a git repository layed out as specified in <a href="https://github.com/rust-lang/rfcs/blob/master/text/2141-alternative-registries.md"><strong>Cargo's Alternative Crate Registries RFC</strong></a>.<br />
It stores metadata about each stored crate and their versions, but not the contents of the crates themselves.</p>
<p>A <strong>crate store</strong> is what takes care of storing the crate contents themselves and then making them available for download.</p>
<h1><a class="header" href="#crate-index" id="crate-index">Crate index</a></h1>
<p>The <strong>crate index</strong> is a git repository where metadata about all the crates managed by a registry is stored.<br />
In a way, it is a snapshot of a registry's knowledge of every crates.</p>
<p>The layout of a crate index is specified in <a href="https://github.com/rust-lang/rfcs/blob/master/text/2141-alternative-registries.md#registry-index-format-specification"><strong>Cargo's Alternative Registries RFC</strong></a>.</p>
<p>Alexandrie will create the directories needed to store a crate automatically, so it suffices to only manually create the <code>config.json</code> file to get going.</p>
<!-- TODO: Reformulate RFC's sections about crate index configuration -->
<p>The way the crate index is accessed is called a <strong>crate index management strategy</strong> (a bit of a mouthful, sorry about that 😅).</p>
<p>Strategies will allow Alexandrie to interact with crate indices in a variety of ways, not only locally but potentially remotely (using a litte server on another machine to perform the operation) where the registry itself doesn't have full access to the underlying git repository.</p>
<h1><a class="header" href="#crate-storage" id="crate-storage">Crate storage</a></h1>
<p>A <strong>crate store</strong> is the place where all the contents of the published crates (the actual code and assets) are stored.</p>
<p>The contents of crates are stored as TAR archives and compressed using Gzip (basically a <code>.tar.gz</code> blob).<br />
The store takes that blob, stores it and make it available for download later on.</p>
<p>Currently, the store is also responsible for storing rendered README pages (which are simple HTML files).</p>
<p>Because these can amount to a lot of storage space, it can be desirable to separate the crates' metadata (modelled by the crate index) and their actual contents (handled by the crate stores).</p>
<p>A crate store may be local (as files on disk, for instance) or remote (as blobs in AWS S3, for instance).</p>
<h1><a class="header" href="#whats-available-" id="whats-available-">What's available ?</a></h1>
<p>Currently, not many options are implemented yet.</p>
<p>As index management strategies, we have:</p>
<ul>
<li><code>cli</code>: local index clone, managed by invocations of the <code>git</code> shell command.</li>
<li><code>git2</code>: just like <code>cli</code>, but uses <code>libgit2</code> instead of relying on the <code>git</code> shell command.</li>
<li><strong>(PLANNED)</strong> <code>remote</code>: remote index clone, managed by a companion server.</li>
</ul>
<p>As crate storage strategies, we have:</p>
<ul>
<li><code>disk</code>: local on-disk crate storage.</li>
<li><strong>(PLANNED)</strong> <code>remote</code>: just like <code>disk</code>, but on a remote machine, managed by a companion server.</li>
<li><strong>(PLANNED)</strong> <code>s3</code>: stores crates in an AWS S3 bucket.</li>
</ul>
<p><strong>PSA:</strong><br />
The 'PLANNED' items are ideas that are possible to implement but no guarantees or deadline as to when they would actually land.<br />
Any help on these items are greatly welcome.</p>
<h1><a class="header" href="#available-index-management-strategies" id="available-index-management-strategies">Available index management strategies</a></h1>
<h2><a class="header" href="#command-line-using-the-shell-git-command" id="command-line-using-the-shell-git-command">'command-line': using the shell 'git' command</a></h2>
<p>This index management strategy invokes the shell 'git' command to manage a local clone of the index's repository.</p>
<p>A limitation of this strategy is that it requires the host machine to have the <code>git</code> command installed and available.</p>
<p>Here is an example and description of a configuration using this index management strategy:</p>
<pre><code class="language-toml">[index]
type = &quot;command-line&quot; # required.
path = &quot;crate-index&quot;  # required: path of the index's local clone.
</code></pre>
<p><strong>NOTE:</strong><br />
The local clone must be present and up-to-date before launching Alexandrie.<br />
Today, Alexandrie won't pull or clone on its own on startup.</p>
<h2><a class="header" href="#git2-using-the-libgit2-library" id="git2-using-the-libgit2-library">'git2': using the <code>libgit2</code> library</a></h2>
<p>This index management strategy uses <code>libgit2</code> to manage a local clone of the index's repository.</p>
<p>The advantage of this strategy over 'command-line' is that it doesn't require <code>git</code> to be installed on the host machine.<br />
The repository interaction is completely independant of the local <code>git</code> installation.</p>
<p>Here is an example and description of a configuration using this index management strategy:</p>
<pre><code class="language-toml">[index]
type = &quot;git2&quot;         # required.
path = &quot;crate-index&quot;  # required: path of the index's local clone.
</code></pre>
<p><strong>NOTE:</strong><br />
The local clone must be present and up-to-date before launching Alexandrie.<br />
Today, Alexandrie won't pull or clone on its own on startup.</p>
<h1><a class="header" href="#available-crate-stores" id="available-crate-stores">Available crate stores</a></h1>
<h2><a class="header" href="#disk-local-on-disk-store" id="disk-local-on-disk-store">'disk': Local on-disk store</a></h2>
<p>This store implements simple local storage of crates as files in a given directory.</p>
<p>Here is an example of a configuration using this storage:</p>
<pre><code class="language-toml">[storage]
type = &quot;disk&quot;           # required.
path = &quot;crate-storage&quot;  # required: path of the directory in which to store the crates.
</code></pre>
<h1><a class="header" href="#running-alexandrie-with-docker" id="running-alexandrie-with-docker">Running Alexandrie with Docker</a></h1>
<p>Alexandrie can be run in a Docker container, which can make it easier to start, stop, and build on a non-Linux system.</p>
<h2><a class="header" href="#dependencies" id="dependencies">Dependencies</a></h2>
<p>To run Alexandrie in docker, you'll need:</p>
<ul>
<li>The <code>Alexandrie</code> source pulled from GitHub</li>
<li><a href="https://docs.docker.com/install/">docker</a></li>
<li><a href="https://docs.docker.com/compose/install/">docker-compose</a></li>
</ul>
<p>Make sure that <code>docker</code> and <code>docker-compose</code> are in your system path.</p>
<h2><a class="header" href="#user-configuration" id="user-configuration">User Configuration</a></h2>
<p>A small bit of setup is required before you can start the docker containers. First, copy <code>example.env</code> to <code>.env</code> (the filename is important, don't prefix the extension), and modify the values inside:</p>
<ul>
<li>Create a new, empty directory where the application can create data, and then set <code>APPDATA</code> to the absolute path to that folder.</li>
<li>Set <code>CRATE_INDEX</code> to the SSH path of an existing git repository with a valid index <code>config.json</code> file.</li>
<li>Set <code>GIT_NAME</code> and <code>GIT_EMAIL</code> to valid git values that will be used when Alexandrie commits &amp; pushes those commits to the index.</li>
<li>Set <code>GIT_SSH_KEY</code> to a new or existing passwordless SSH key. The <code>.pub</code> key associated with this key should be added to github/gitlab/etc. to grant access to clone and push the crate index.</li>
</ul>
<p>By default Alexandrie will use SQLite. If you want to use either MySQL or PostgreSQL instead, you'll need to create a file at either <code>docker/mysqsl/rootpass.txt</code> or <code>docker/postgresql/rootpass.txt</code> which contains the password that will be given to the root user of the database.</p>
<h3><a class="header" href="#additional-configuration" id="additional-configuration">Additional Configuration</a></h3>
<p>If necessary, <code>alexandrie.toml</code> and even <code>diesel.toml</code> can still be modified, and the docker images can be configured to use those modified files instead. You should read the <a href="whats-available/docker.html#internals">Internals</a> section first, and will likely need to already have docker knowledge. Some other config files and scripts will need to be modified if you change Alexandrie's port or appdata mount location, for example.</p>
<h2><a class="header" href="#usage" id="usage">Usage</a></h2>
<h3><a class="header" href="#running" id="running">Running</a></h3>
<p>To run, you can use the <code>run_docker.sh</code> script for easy setup or teardown. See <code>run_docker.sh --help</code> for a list of options.</p>
<p>By default, Alexandrie will use SQLite and run in the background. </p>
<p><strong>Bringup</strong></p>
<pre><code class="language-bash">./run_docker.sh up
</code></pre>
<p>If you want to use MySQL and run in the foreground, here's an example:</p>
<pre><code class="language-bash">./run_docker.sh up --mysql -f
</code></pre>
<p>If you run in the foreground and kill the services with <code>Ctrl+C</code>, the docker containers will stop, but you still may need to run <a href="whats-available/docker.html#stopping-and-cleanup">teardown</a> for the containers to be deleted fully.</p>
<h3><a class="header" href="#stopping-and-cleanup" id="stopping-and-cleanup">Stopping and Cleanup</a></h3>
<p>Stopping Alexandrie is as easy as starting it.</p>
<p><strong>Teardown</strong></p>
<pre><code class="language-bash">./run_docker.sh down
</code></pre>
<p>To stop, for example, a MySQL setup for Alexandrie, run the following:</p>
<pre><code class="language-bash">./run_docker.sh down --mysql
</code></pre>
<p>If you're not planning on running Alexandrie again or want to do a full clean of the environment, you can disassociate your local appdata storage from the docker volume database by doing <code>docker volume prune</code>, which will delete all unused volumes.</p>
<h3><a class="header" href="#next-steps" id="next-steps">Next Steps</a></h3>
<p>As Alexandrie will (by default) serve on port <code>3000</code> (and directly setting that to port <code>80</code> will likely not work for a non-root user and won't allow https), the recommended way to serve the application would be to install &amp; configure <code>nginx</code> or another ingress controller.</p>
<h2><a class="header" href="#internals" id="internals">Internals</a></h2>
<p>The <code>run_docker</code> script is using <code>docker-compose</code> under the hood, which is itself just <code>docker</code> instrumentation. <code>docker-compose</code> is configured for this project through a few files:</p>
<ul>
<li><code>.env</code>: contains variables that can be changed by the user for easy configuration</li>
<li><code>docker-compose.yaml</code>: basic setup for docker images, volumes, etc.; should rarely be touched by the user</li>
<li><code>docker/&lt;database&gt;/&lt;database&gt;-compose.yaml</code>: supplemental and database-dependent; should rarely be touched by the user</li>
</ul>
<p>Some additional files are responsible for actually creating the Docker image for Alexandrie, as well as handling starting the application, database, etc.:</p>
<ul>
<li><code>Dockerfile</code>: definition for creating the Docker image for Alexandrie itself</li>
<li><code>docker/startup.sh</code>: ran inside the Docker image to do first-run database initialization with diesel, ssh &amp; git configuration, and start Alexandrie</li>
<li><code>docker/&lt;database&gt;/alexandrie.toml</code>: application configuration, which has database-dependent features</li>
</ul>
<p>Modifying <code>alexandrie.toml</code> may require additional modification of some of these files, for example if the port is modified.</p>
<p>It's worth mentioning that the Docker image will copy the Alexandrie source contained in the local directory, a.k.a. the source isn't pulled down from the git repo when building the image. If you modifiy the source code, those modifications can be used to make the image for testing, etc.</p>
<h3><a class="header" href="#example-run" id="example-run">Example Run</a></h3>
<p>To start Alexandrie in Docker without the <code>run_docker</code> script, you could do:</p>
<pre><code class="language-bash">export DATABASE=mysql
docker-compose -f docker-compose.yaml -f docker/mysql/mysql-compose.yaml up
</code></pre>
<p>This will use all of the following files, in addition to the Alexandrie source code:</p>
<ul>
<li><code>docker-compose.yaml</code></li>
<li><code>.env</code></li>
<li><code>diesel.toml</code></li>
<li><code>Dockerfile</code></li>
<li><code>docker/startup.sh</code></li>
<li><code>docker/mysql/mysql-compose.yaml</code></li>
<li><code>docker/mysql/alexandrie.toml</code></li>
<li><code>docker/mysql/rootpass.txt</code></li>
</ul>
<h3><a class="header" href="#database" id="database">Database</a></h3>
<p>Databases will put their data in an appropriately named directory inside the user-defined <code>APPDATA</code> directory (see <a href="whats-available/docker.html#user-configuration">User Configuration</a>). If the directory already exists, it must either <strong>(a)</strong> have valid database data inside, or <strong>(b)</strong> be empty. Directly modifying files inside the database directory isn't recommended, and can cause the server to fail to start entirely. Don't add extra files or create a file inside an empty database directory; the database will almost certainly complain.</p>
<h1><a class="header" href="#database-layout" id="database-layout">Database layout</a></h1>
<p>This page describes the database tables that Alexandrie uses.</p>
<p>The types of the tables' fields are chosen to be compatible with all the database vendors supported by Alexandrie.</p>
<p>Here is a high-level picture of the different tables and their relationships:</p>
<p><img src="./alexandrie-database-relationships.png" alt="alexandrie-database-relationships" /></p>
<p>The <strong><code>crates</code></strong> table stores metadata about the latest version of each stored crate.<br />
It is meant to store the most useful metadata for fast access.<br />
If more complete metadata is required or metadata about an older version is needed, the crate-index can be queried for this.</p>
<p>The <strong><code>authors</code></strong> table stores the list of every registered crate authors of the registry.<br />
It stores details like emails, fullnames and a signature of the author's password.<br />
Details about what this signature really is, and how to compute it from the users' password is available at:<br />
<a href="https://polomack.eu/alexandrie-security"><strong>https://polomack.eu/alexandrie-security</strong></a></p>
<p>The <strong><code>keywords</code></strong> and <strong><code>categories</code></strong> tables store the keywords and categories used by the registry's crates.<br />
The <strong><code>keywords</code></strong> table can gain new entries as crates makes use of new distinct keywords.<br />
The <strong><code>categories</code></strong> table, on the other hand, is fixed and not expandable by crates.</p>
<p>The <strong><code>salts</code></strong> table stores the salts generated for each registered author and used to compute their passwords' signatures.<br />
The <strong><code>sessions</code></strong> table stores details about the frontend sessions for registered authors.<br />
Sessions are not automatically deleted when expired, so a cleanup periodic clean may be required to prune expired sessions.<br />
The <strong><code>author_tokens</code></strong> tables stores the generated Cargo authentication tokens for registered users (used for <code>cargo login</code>).</p>
<p>The <strong><code>crate_categories</code></strong>, <strong><code>crate_keywords</code></strong> and <strong><code>crate_authors</code></strong> are all one-to-many relationship tables.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
